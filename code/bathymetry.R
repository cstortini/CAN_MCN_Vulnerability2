#code to read in bathymetry data

#neccessary libraries
library(googledrive)
library(sf)
library(dplyr)

sf_use_s2(FALSE) 

#file path
pathdir_bath <- "data/bathymetry.csv"

#google drive link
gd_bath <- "https://drive.google.com/file/d/1w-XxMtL8lDA7D-Y3_Jn3ZDbr4Ns8sKoP/view?usp=drivesdk"

#drive_download(as_id(gd_bath), path=pathdir_bath)

vuln_lat_lon <- rbind(rcp_26,rcp_85)

##Dan's code 

##GEOGRAPHIC DOMAIN
#latd<-c(min(vdata$lat),max(vdata$lat))
#lond<-c(min(vdata$lon),max(vdata$lon))

#matching up names since vdata didn't exist in this project
latd<-c(min(vuln_lat_lon$lat),max(vuln_lat_lon$lat))
lond<-c(min(vuln_lat_lon$lon),max(vuln_lat_lon$lon))

##CRS SYSTEM
mct<- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"

##RETREIVE BATHYMETRY FROM NOAA
library(marmap)
bth<-getNOAA.bathy(lon1=lond[1],lon2=lond[2],lat1=latd[1],lat2=latd[2], resolution=1)
bthr<-as.raster(bth)
crs(bthr) <- mct
plot(bthr)

##EMPTY 0.25 DEGREE RASTER
crds<-expand.grid(lon=seq(lond[1],lond[2],0.25),
                  lat=seq(latd[1],latd[2],0.25))
r0.25deg<-rasterFromXYZ(crds)
crs(r0.25deg) <- mct

##INTERPOLATE BATHYMETRY TO DESIRED GRID SIZE
bthr<-raster::resample(bthr, r0.25deg, method='ngb')

##CONVERT TO FLAT FILE
xy<-data.frame(coordinates(bthr))
bthd<-data.frame(lon=xy$x,
                 lat=xy$y,
                 bathy=getValues(bthr))
