#loading in the neccessary libraries
library(dplyr)
library(ggplot2)
library(patchwork)

#best plots so far 
library(ggridges)

#by ocean
ggplot(rcp_26, aes(x=vuln, y=ocean))+geom_density_ridges(fill = "light blue",alpha = 0.5, color = 4, linetype = 1, lwd = 0.25, scale =1)
ggplot(rcp_26, aes(x=vuln, y=ocean, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")
ggplot(rcp_85, aes(x=vuln, y=ocean))+geom_density_ridges(fill = "light blue",alpha = 0.5, color = 4, linetype = 1, lwd = 0.25, scale =1)
ggplot(rcp_85, aes(x=vuln, y=ocean, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")


#by region
ggplot(rcp_26, aes(x=vuln, y=region, fill=region))+geom_density_ridges()
ggplot(rcp_26, aes(x=vuln, y=region, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")
ggplot(rcp_85, aes(x=vuln, y=region, fill=region))+geom_density_ridges()
ggplot(rcp_85, aes(x=vuln, y=region, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")


#trying to color by quantile?
ggplot(rcp_26, aes(x = vuln, y= ocean, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")
ggplot(rcp_26, aes(x = vuln, y= region, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")+
  facet_wrap(~ocean,nrow=3,scales="free_y")
ggplot(rcp_85, aes(x = vuln, y= ocean, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")
ggplot(rcp_85, aes(x = vuln, y= region, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")+
  facet_wrap(~ocean,nrow=3,scales="free_y")



#looking at tail probabilities - I don't exactly know what this does

ggplot(rcp_26, aes(vuln, y = ocean,
               fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

ggplot(rcp_26, aes(vuln, y = region,
               fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

ggplot(rcp_85, aes(vuln, y = ocean,
                   fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

ggplot(rcp_85, aes(vuln, y = region,
                   fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

#boxplots of the data
#by ocean basin
ggplot(rcp_26, aes(x = ocean, y = vuln, fill = ocean)) + 
  stat_boxplot(geom = "errorbar", width = 0.25) + 
  geom_boxplot() +
  scale_fill_hue(labels = c("Arctic", "Atlantic", "Pacific"))

ggplot(rcp_85, aes(x = ocean, y = vuln, fill = ocean)) + 
  stat_boxplot(geom = "errorbar", width = 0.25) + 
  geom_boxplot() +
  scale_fill_hue(labels = c("Arctic", "Atlantic", "Pacific"))

#by region
ggplot(rcp_26, aes(x = region, y = vuln, fill = region)) + 
  stat_boxplot(geom = "errorbar", width = 0.25) + 
  geom_boxplot() + coord_flip()+
  scale_fill_hue(labels = c("Arctic Archipelago", "Arctic Basin", "Eastern Arctic", "Gulf of Saint Lawrence", "Hudson Bay Complex", "Newfoundland-Labrador Shelves", "Northern Shelf", "Offshore Pacific", "Scotian Shelf", "Southern Shelf", "Strait of Georgia", "Western Arctic"))+
  theme(legend.position = "none", axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  facet_wrap(~ocean,nrow=3,scales="free_y")


ggplot(rcp_85, aes(x = region, y = vuln, fill = region)) + 
  stat_boxplot(geom = "errorbar", width = 0.25) + 
  geom_boxplot() +
  scale_fill_hue(labels = c("Arctic Archipelago", "Arctic Basin", "Eastern Arctic", "Gulf of Saint Lawrence", "Hudson Bay Complex", "Newfoundland-Labrador Shelves", "Northern Shelf", "Offshore Pacific", "Scotian Shelf", "Southern Shelf", "Strait of Georgia", "Western Arctic"))+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  facet_wrap(~ocean,nrow=3,scales="free_y")

#by MPA
ggplot(rcp_26 %>% dplyr::filter( type == "MPA"), aes(x = name, y = vuln, fill = name)) +
  stat_boxplot(geom = "errorbar", width = 0.25) + coord_flip()+
    theme(legend.position = "none", axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  geom_boxplot() 
  
ggplot(rcp_85 %>% dplyr::filter( type == "MPA"), aes(x = name, y = vuln, fill = name)) +
    stat_boxplot(geom = "errorbar", width = 0.25) + coord_flip()+
    theme(legend.position = "none", axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
    geom_boxplot() 

#trying to plot MPAs with regions...

#transforming to make a smaller dataset maybe?
#trying to melt the data using something I found online
#Error: column names are wrong? 
rcp_26_long <- melt(rcp_26, type = "MPA") 
head(rcp_26_long)

#maybe cutting down data frame first to be less columns?
small_rcp_26 <- subset(rcp_26, select = c("vuln", "vulnsd", "ocean", "region", "type", "name"))
#removing NAs
small_rcp_26. <- small_rcp_26[!(is.na(small_rcp_26$"type")), ]
#plotting with smaller dataset... it doesn't look like anything significantly different happened?

#making it 2 separate datasets
dta1 = subset(rcp_26, select = c("vuln", "vulnsd", "ocean", "region")) #for the regions
dta2 = subset(rcp_26 %>% dplyr::filter( type == "MPA"), select = c("vuln", "vulnsd", "ocean", "type", "name")) #for the MPAs

#trying to merge the 2 subsets back into 1 coherent graph, having trouble with the MPA one
#not sure how to filter it like how I did line 88 & 93 above
ggplot()+
  geom_boxplot(data=dta1, aes(x=name, y=vuln, fill = region))+
  scale_size_manual(values = c(1,2,3))+
  new_scale("size")+
  geom_boxplot(data=dta2, aes(x=name, y=vuln, fill = name))+
  theme_bw(base_size = 16)

install.packages('ggnewscale')
library(ggnewscale)
