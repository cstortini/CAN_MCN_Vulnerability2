#loading in the neccessary libraries
library(dplyr)
library(ggplot2)
library(patchwork)

#best plots so far 
library(ggridges)

#by ocean
ggplot(rcp_26, aes(x=vuln, y=ocean))+geom_density_ridges(fill = "light blue",alpha = 0.5, color = 4, linetype = 1, lwd = 0.25, scale =1)
ggplot(rcp_26, aes(x=vuln, y=ocean, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")
ggplot(rcp_85, aes(x=vuln, y=ocean))+geom_density_ridges(fill = "light blue",alpha = 0.5, color = 4, linetype = 1, lwd = 0.25, scale =1)
ggplot(rcp_85, aes(x=vuln, y=ocean, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")


#by region
ggplot(rcp_26, aes(x=vuln, y=region, fill=region))+geom_density_ridges()
ggplot(rcp_26, aes(x=vuln, y=region, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")
ggplot(rcp_85, aes(x=vuln, y=region, fill=region))+geom_density_ridges()
ggplot(rcp_85, aes(x=vuln, y=region, fill=stat(x)))+geom_density_ridges_gradient()+scale_fill_viridis_c(name = "vulnerability", option = "C")


#trying to color by quantile?
ggplot(rcp_26, aes(x = vuln, y= ocean, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")
ggplot(rcp_26, aes(x = vuln, y= region, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")
ggplot(rcp_85, aes(x = vuln, y= ocean, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")
ggplot(rcp_85, aes(x = vuln, y= region, fill=stat(quantile)))+stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, geom = "density_ridges_gradient")+scale_fill_brewer(name="")


#looking at tail probabilities - I don't exactly know what this does

ggplot(rcp_26, aes(vuln, y = ocean,
               fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

ggplot(rcp_26, aes(vuln, y = region,
               fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

ggplot(rcp_85, aes(vuln, y = ocean,
                   fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")

ggplot(rcp_85, aes(vuln, y = region,
                   fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = "density_ridges_gradient", calc_ecdf = TRUE) +
  scale_fill_gradient(low = "white", high = "#87CEFF",
                      name = "Tail prob.")
#failed histogram attempts
#start by chopping the vulnerability data from RCP 2.6 and removing unnecessary columns

pathdir_26 <- "data/climate_vulnerability_26.csv"

vul_df2.6 <- rbind(read.csv(pathdir_26)) %>%
  dplyr :: select(-adcap, -sens, -expo, -adcapsd, -senssd, -exposd, -tl, -nspecies)

expo_df2.6 <- rbind(read.csv(pathdir_26)) %>%
  dplyr :: select(rcp, lat, lon, expo, exposd)

adcap_df2.6 <- rbind(read.csv(pathdir_26)) %>%
  dplyr :: select(rcp, lat, lon, adcap, adcapsd)

sens_df2.6 <- rbind(read.csv(pathdir_26)) %>%
  dplyr :: select(rcp, lat, lon, sens, senssd)


str(vul_df2.6) # see how the data looks
vul_df2.6 %>% group_by(lat)%>%str # sub-grouping it

vuln_bylat <- vul_df2.6%>% #making a summary table
  group_by(lat)%>%
  summarise(mean_vulnbylat = mean(vuln))

expo_bylat <- expo_df2.6%>%
  group_by(lat)%>%
  summarise(mean_expobylat = mean(expo))

adcap_bylat <- adcap_df2.6%>%
  group_by(lat)%>%
  summarise(mean_adcapbylat = mean(adcap))

sens_bylat <- sens_df2.6%>%
  group_by(lat)%>%
  summarise(mean_sensbylat = mean(sens))

vuln_bylat #view that summary table
expo_bylat
adcap_bylat
sens_bylat

#going back to basics of ggplot and working from there

p1 <- ggplot(data = vuln_bylat) +
  geom_point(mapping = aes (x = lat, y = mean_vulnbylat))+geom_smooth(mapping = aes (x = lat, y = mean_vulnbylat))+ labs( x= "Latitude", y = "Vulnerability", title = "Average Vulnerability by Latitude")

p2 <- ggplot(data = expo_bylat) +
     geom_point(mapping = aes (x = lat, y = mean_expobylat))+geom_smooth(mapping = aes (x = lat, y = mean_expobylat))+ labs( x= "Latitude", y = "Exposure", title = "Average Exposure by Latitude")

p3 <- ggplot(data = adcap_bylat) +
  geom_point(mapping = aes (x = lat, y = mean_adcapbylat))+geom_smooth(mapping = aes (x = lat, y = mean_adcapbylat))+ labs( x= "Latitude", y = "Adaptive Capacity", title = "Average Adaptive Capacity by Latitude")

p4 <- ggplot(data = sens_bylat) +
  geom_point(mapping = aes (x = lat, y = mean_sensbylat))+geom_smooth(mapping = aes (x = lat, y = mean_sensbylat))+ labs( x= "Latitude", y = "Sensitivity", title = "Average Sensitivity by Latitude")

p5 <- p1 + p2 + p3 + p4

plot(p5)



############################################

# mistakes while trying to plot histograms

typeof(vul_df2.6)
#vul_df is a list and needs to be numeric

unlist(vul_df2.6)

lapply(vul_df2.6, as.numeric) # now that the data are unlisted I try to convert to numeric

is.numeric(vul_df2.6) #still false...

#converting all columns to numeric individually?
vul_df2.6$rcp <- lapply(vul_df2.6$rcp, as.numeric)
vul_df2.6$lon <- lapply(vul_df2.6$lon, as.numeric)
vul_df2.6$lat <- lapply(vul_df2.6$lat, as.numeric)
vul_df2.6$vuln <- lapply(vul_df2.6$vuln, as.numeric)
vul_df2.6$vulnsd <- lapply(vul_df2.6$vulnsd, as.numeric)


#taking a different approach and trying to cut down/ group the data to make sense of it
a <- vul_df2.6%>%
  dplyr::filter(lat == "41.375")
b <- vul_df2.6%>%
  dplyr::filter(lat == "77.875")
c <- vul_df2.6%>%
  dplyr::filter(lat == "77.625")
d <- vul_df2.6%>%
  dplyr::filter(lat == "77.375")
e <- vul_df2.6%>%
  dplyr::filter(lat == "41.125")
#mean at single latitude points
mean(vul_df2.6[vul_df2.6$lat == "41.375", "vuln"])
mean(vul_df2.6[vul_df2.6$lat == "77.875", "vuln"])
mean(vul_df2.6[vul_df2.6$lat == "77.625", "vuln"])
mean(vul_df2.6[vul_df2.6$lat == "77.375", "vuln"])
mean(vul_df2.6[vul_df2.6$lat == "41.125", "vuln"])

#found a more efficient method

typeof(vuln_bylat) # list
unlist(vuln_bylat)
lapply(vuln_bylat, as.numeric)
#still running into the issue of changing the data from list to numeric


