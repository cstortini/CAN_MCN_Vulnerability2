#Density overlap function - adapted from Dan's code

densFun <- function(x,percent_overlap=TRUE){
  
  if(length(unique(x$location))==1){ #"Southern Shelf","Arctic Archipelago","Hudson Bay Complex" have no 'inside'
    
    dens.total<-density(x$vuln,na.rm=TRUE,
                        from = 0,
                        to = 1)
    
    df2 <- data.frame(x = dens.total$x, 
                      y = dens.total$y,
                      Data = rep("Outside MPAs", each = length(dens.total$x)))
    
  }
  
  if(length(unique(x$location))==2){
    
    dens.inside<-density(x%>%filter(location=="inside")%>%pull(vuln),na.rm=TRUE,
                         from = 0,
                         to = 1)
    
    dens.total<-density(x$vuln,na.rm=TRUE,
                        from = 0,
                        to = 1)
    
    joint <- pmin(dens.inside$y, dens.total$y)
    
    df2 <- data.frame(x = rep(dens.inside$x, 3), 
                      y = c(dens.inside$y, dens.total$y, joint),
                      Data = rep(c("Inside MPAs", "Inside + Outside", "Overlap"), each = length(dens.inside$x)))
    
  }
  
  if(percent_overlap){return(data.frame(overlap_percent = sum(joint)/sum(dens.total$y)))}else{return(df2)}
  
}